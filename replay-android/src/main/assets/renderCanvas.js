var renderCanvas;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{function n(e,t,n,i){return t.map((t=>{if(n[t]){n[t].globalSpriteIds.push(e);const{data:i}=n[t];return"then"in i?i:Promise.resolve()}const r=i(t).then((e=>{n[t].data=e}));return n[t]={globalSpriteIds:[e],data:r},r}))}function i(e,t,n){for(const i in t){const{globalSpriteIds:r}=t[i],o=r.indexOf(e);-1!==o&&(1===r.length?(n(i),delete t[i]):t[i].globalSpriteIds.splice(o,1))}}function r(e){var t,n,i;return{x:e.x||0,y:e.y||0,rotation:e.rotation||0,opacity:Math.min(1,Math.max(0,null!==(t=e.opacity)&&void 0!==t?t:1)),scaleX:null!==(n=e.scaleX)&&void 0!==n?n:1,scaleY:null!==(i=e.scaleY)&&void 0!==i?i:1,anchorX:e.anchorX||0,anchorY:e.anchorY||0,mask:e.mask||null}}function o(e,t){var n,i,r;e.x=t.x||0,e.y=t.y||0,e.rotation=t.rotation||0,e.opacity=Math.min(1,Math.max(0,null!==(n=t.opacity)&&void 0!==n?n:1)),e.scaleX=null!==(i=t.scaleX)&&void 0!==i?i:1,e.scaleY=null!==(r=t.scaleY)&&void 0!==r?r:1,e.anchorX=t.anchorX||0,e.anchorY=t.anchorY||0,e.mask=t.mask||null}function s(e,t,n,r,s,l,d,c,p,u,h,m){const{baseProps:g}=e;o(g,t);const f=e=>{const t=s(e);return function(e){const t=Math.PI/180,n=-(e.rotation||0)*t;return({x:t,y:i})=>{const r=t-e.x,o=i-e.y,s=r*Math.cos(n)+o*Math.sin(n),a=-r*Math.sin(n)+o*Math.cos(n),l=s/e.scaleX,d=a/e.scaleY;return{x:l+e.anchorX,y:d+e.anchorY}}}(g)(t)};let w=null;const v=()=>(w||(w=r(f)),w),y=e.getSprites(t,v,l,d,c,m),S=e.prevChildIdsSet,b=e.prevChildIds;let P=0;if(h.startRenderSprite(g),a(y,e,n,r,d,c,p,u,h,m,(e=>{b[P]=e,P++,S.delete(e)}),v,f),h.endRenderSprite(),u.nativeSpriteUtils.didResize=!1,P<b.length&&(b.length=P),S.forEach((t=>{const r=(e,t)=>{Object.entries(e).forEach((([e,o])=>{if("custom"===o.type){const s=`${t}--${e}`;r(o.childContainers,s),o.cleanup(v),o.loadFilesPromise&&o.loadFilesPromise.then((()=>{var e,t;i(e=s,(t=n.assetUtils).audioElements,t.cleanupAudioFile),i(e,t.imageElements,t.cleanupImageFile)}))}else"native"===o.type&&o.cleanup({state:o.state,parentGlobalId:p})}))},o=e.childContainers[t];r({[t]:o},p),delete e.childContainers[t]})),e.prevChildIdsSet=new Set(b),e.prevChildIdsSet.size<b.length){const e=b.find(((e,t)=>b.indexOf(e)!==t));throw Error(`Duplicate Sprite id ${e}`)}}function a(e,t,n,i,r,o,l,c,h,m,g,f,w){for(let v=0;v<e.length;v++){const y=e[v];if(y)if("context"===y.type)a(y.sprites,t,n,i,r,o,l,c,h,[...m,y],g,f,w);else if("native"===y.type){g(y.props.id);const{nativeSpriteMap:e,nativeSpriteUtils:n}=c,i=e[y.name];if(!i)throw Error(`Cannot find Native Sprite "${y.name}"`);let r=t.childContainers[y.props.id];if(!r||"native"!==r.type){const e={type:"native",state:i.create({props:y.props,parentGlobalId:l,getState:()=>e.state,updateState:t=>{e.state={...e.state,...t}},utils:n}),cleanup:i.cleanup};t.childContainers[y.props.id]=e,r=e}r.state=i.loop({props:y.props,state:r.state,parentGlobalId:l,utils:n})}else if("pure"===y.type){g(y.props.id);let e=t.childContainers[y.props.id];e&&"pure"===e.type||(e=p(y),t.childContainers[y.props.id]=e),u(e,y.props,n.size,c.nativeSpriteUtils.didResize,r,h)}else if("custom"===y.type){g(y.props.id);let e=!1,a=t.childContainers[y.props.id];const p=`${l}--${y.props.id}`;a&&"custom"===a.type||(e=!0,a=d(y,n,f,t.prevTime,p,m),t.childContainers[y.props.id]=a),s(a,y.props,n,i,w,e,r,o,p,c,h,m)}else h.renderTexture(y)}}e.r(t),e.d(t,{run:()=>_});const l=1/60*1e3;function d(e,t,i,o,s,a){const{spriteObj:l,props:d}=e,c=[],p=e=>{c.push(e)};let u,h=null,m=null;l.init&&(u=l.init({props:d,getState:()=>{if(!h)throw Error("Cannot call getState synchronously in init");return h.state},device:t,getInputs:i,updateState:p,getContext:e=>{const t=a.find((t=>t.context===e));if(!t)throw Error("No context setup");return t.value},preloadFiles:async e=>{const i=async function(e,t,i){await Promise.all([...n(e,t.audioFileNames||[],i.audioElements,i.loadAudioFile),...n(e,t.imageFileNames||[],i.imageElements,i.loadImageFile)])}(s,e,t.assetUtils);h?h.loadFilesPromise=i:m=i,await i}}));const g=()=>{let e=0;for(;e<c.length;){const t=c[e];h.state=t(h.state),e++}c.length=0},f=()=>h.state;return h={type:"custom",state:u,baseProps:r(d),childContainers:{},prevChildIds:[],prevChildIdsSet:new Set,prevTime:o,currentLag:0,loadFilesPromise:m,getSprites(e,n,i,r,o,s){g();const a=e=>{const t=s.find((t=>t.context===e));if(!t)throw Error("No context setup");return t.value};!i&&l.loop&&(this.state=l.loop({props:e,state:this.state,device:t,getInputs:n,updateState:p,getState:f,getContext:a})),g();let d=l[r];d||(d="renderPXL"===r&&l.renderXL?l.renderXL:l.render);const c=d({props:e,state:this.state,device:t,getInputs:n,updateState:p,getState:f,getContext:a,extrapolateFactor:o});return g(),c},cleanup(e){var n;null===(n=l.cleanup)||void 0===n||n.call(l,{state:this.state,device:t,getInputs:e})}},h}function c(e,t){const n=e.deviceHeight>e.deviceWidth;let i,r=!1;return"portrait"in t?(i=n?t.portrait:t.landscape,r=!0):i=t,i.minHeightXL&&e.deviceHeight>=i.minHeightXL||i.minWidthXL&&e.deviceWidth>=i.minWidthXL?r&&n?"renderPXL":"renderXL":r&&n?"renderP":"render"}function p(e){const{spriteObj:t}=e;return{type:"pure",childContainers:{},prevChildIds:[],prevChildIdsSet:new Set,baseProps:r(e.props),getSprites(e,n,i,r){if(this.prevProps&&this.cache&&!t.shouldRerender(this.prevProps,e)&&!i)return this.prevProps=e,this.cache;let o=t[r];return o||(o="renderPXL"===r&&t.renderXL?t.renderXL:t.render),this.prevProps=e,{type:"pureSprites",sprites:o({props:e,size:n})}}}}function u(e,t,n,i,r,s){const{baseProps:a}=e;o(a,t);const l=e.getSprites(t,n,i,r);return"cache"===l.type?(h(l,s),l):function(e,t,n,i,r,o){const{baseProps:s}=e,a=e.prevChildIdsSet,l=e.prevChildIds;let d=0;o.startRenderSprite(s);const c=new Array(t.length);let h=0;for(let s=0;s<t.length;s++){const m=t[s];if(m)if("pure"===m.type){l[d]=m.props.id,d++,a.delete(m.props.id);let t=e.childContainers[m.props.id];t&&"pure"===t.type||(t=p(m),e.childContainers[m.props.id]=t),c[h]=u(t,m.props,n,i,r,o),h++}else o.renderTexture(m),c[h]=m,h++}h<c.length&&(c.length=h),o.endRenderSprite(),a.forEach((t=>{delete e.childContainers[t]}));const m={type:"cache",baseProps:s,items:c};if(e.cache=m,d<l.length&&(l.length=d),e.prevChildIdsSet=new Set(l),e.prevChildIdsSet.size<l.length){const e=l.find(((e,t)=>l.indexOf(e)!==t));throw Error(`Duplicate Sprite id ${e}`)}return m}(e,l.sprites,n,i,r,s)}function h(e,t){t.startRenderSprite(e.baseProps);for(let n=0;n<e.items.length;n++){const i=e.items[n];"cache"===i.type?h(i,t):t.renderTexture(i)}t.endRenderSprite()}let m={keysDown:{},keysJustPressed:{},pointer:{pressed:!1,numberPressed:0,justPressed:!1,justReleased:!1,x:0,y:0}},g=[];function f(e){return function(e,t){const n=e(t.pointer);return{...t,pointer:{...t.pointer,x:n.x,y:n.y}}}(e,m)}function w(e){["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)&&!(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement)&&e.preventDefault(),m.keysDown[e.key]=!0,m.keysJustPressed[e.key]=!0}function v(e){delete m.keysDown[e.key]}function y(e,t,n){g.includes(n)||(g=[...g,n]),m.pointer.pressed=!0,m.pointer.numberPressed=g.length,m.pointer.justPressed=!0,m.pointer.x=e,m.pointer.y=t}function S(e,t){m.pointer.x=e,m.pointer.y=t}function b(e,t,n){g=g.filter((e=>e!==n)),0===g.length&&(m.pointer.justPressed=!1,m.pointer.pressed=!1),m.pointer.numberPressed=g.length,m.pointer.justReleased=!0,m.pointer.x=e,m.pointer.y=t}function P(e){g=g.filter((t=>t!==e)),m.pointer.numberPressed=g.length,0===g.length&&(m.pointer.justPressed=!1,m.pointer.pressed=!1)}function T(){m={keysDown:m.keysDown,keysJustPressed:{},pointer:{...m.pointer,justPressed:!1,justReleased:!1}}}const x=(e,t)=>{const[[n,i],[r,o]]=t.path,s=e.createLinearGradient(n,i,r,o);return t.colors.forEach((({offset:e,color:t})=>{s.addColorStop(e,t)})),s},E=(e,t)=>{const n=e[t];if(!n)throw Error(`Image file "${t}" was not preloaded`);if("then"in n.data)throw Error(`Image file "${t}" did not finish loading before it was used`);return n.data},M=Math.PI/180,k=(e,t,n)=>{const{x:i,y:r,rotation:o,scaleX:s,scaleY:a,anchorX:l,anchorY:d,opacity:c}=t;0===i&&0===r||e.translate(i,-r),0!==o&&e.rotate(o*M),1===s&&1===a||e.scale(s,a),0===l&&0===d||e.translate(-l,d),1!==c&&(e.globalAlpha=n),function(e,t){if(!t)return 0;switch(t.type){case"lineMask":{const[[n,i],...r]=t.path;return e.beginPath(),e.moveTo(n,-i),r.forEach((([t,n])=>{e.lineTo(t,-n)})),e.clip(),0}case"circleMask":return e.beginPath(),e.arc(t.x,-t.y,Math.round(t.radius),0,2*Math.PI),e.clip(),0;case"rectangleMask":e.beginPath(),e.rect(t.x-t.width/2,-t.y-t.height/2,t.width,t.height),e.clip()}}(e,t.mask)},C=e=>({globalAlphaStack:[1],circle(t,n,i){e.beginPath(),e.arc(0,0,Math.round(t),0,2*Math.PI),e.fillStyle=i?x(e,i):n,e.fill(),e.closePath()},rectangle(t,n,i,r){e.fillStyle=r?x(e,r):i,e.fillRect(-t/2,-n/2,t,n),e.closePath()},line(t,n,i,r,o,s,a){if(t.length<2)return;const[[l,d],...c]=t;e.beginPath(),e.moveTo(l,-d),c.forEach((([t,n])=>{e.lineTo(t,-n)})),s?(e.fillStyle=x(e,s),e.fill()):r&&(e.fillStyle=r,e.fill()),o?(e.strokeStyle=x(e,o),e.lineWidth=n,e.lineCap=a,e.stroke()):i&&(e.strokeStyle=i,e.lineWidth=n,e.lineCap=a,e.stroke())},text(t,n,i,r,o,s=1){const{size:a,weight:l="normal",style:d="normal",family:c}=t,p=`${d} ${l} ${a?`${a}px`:""} ${c?`${c}`:""}`;e.font=p,e.textBaseline=t.baseline||"middle",e.textAlign=t.align||"center",o&&(e.strokeStyle=o,e.lineWidth=s,e.strokeText(n,0,0)),e.fillStyle=r?x(e,r):i,e.fillText(n,0,0)},image(t,n,i){e.drawImage(t,-n/2,-i/2,n,i)},spriteSheet(t,n,i,r,o,s){const a=t.width/n,l=t.height/i,d=r%n,c=Math.floor(r/n)%i;e.drawImage(t,d*a,c*l,a,l,-o/2,-s/2,o,s)}});function I(e,t,n,i){let r;r="portrait"in i?t>e?i.portrait:i.landscape:i;const{width:o,height:s,maxWidthMargin:a=0,maxHeightMargin:l=0}=r;if("game-coords"===n||0===e||0===t)return{width:o,height:s,widthMargin:0,heightMargin:0,deviceWidth:o,deviceHeight:s};const d=o/s;if(d>e/t){const n=e,i=n/d,r=i/s*l,a=Math.min(t,i+2*r);return{width:o,height:s,widthMargin:0,heightMargin:(a-i)/2*(s/i),deviceWidth:n,deviceHeight:a}}{const n=t,i=n*d,r=i/o*a,l=Math.min(e,i+2*r);return{width:o,height:s,widthMargin:(l-i)/2*(o/i),heightMargin:0,deviceWidth:l,deviceHeight:n}}}function L(){const e={};return{start:(t,n)=>{const i=window.setTimeout((()=>{delete e[r],t()}),n),r=String(i);return e[r]={timeoutId:i,callback:t,timeStartedMs:Date.now(),timeRemainingMs:n,isPaused:!1},r},pause:t=>{const n=e[t];if(!n||n.isPaused)return;const i=Date.now()-n.timeStartedMs;n.timeRemainingMs-=i,n.isPaused=!0,window.clearTimeout(n.timeoutId)},resume:t=>{const n=e[t];if(!n||!n.isPaused)return;n.timeStartedMs=Date.now(),n.isPaused=!1;const i=window.setTimeout((()=>{delete e[t],n.callback()}),n.timeRemainingMs);n.timeoutId=i},cancel:t=>{const n=e[t];n&&(window.clearTimeout(n.timeoutId),delete e[t])}}}function R(e,t){return n=>{if(!t[n])throw Error(`Audio file "${n}" was not preloaded`);const{data:i}=t[n];if("then"in i)throw Error(`Audio file "${n}" did not finish loading before it was used`);const{buffer:r,playState:o}=i;return{getPosition:()=>z(e,i.playState),play:s=>{let a,l=!1,d=!1,c=1;"number"==typeof s?a=s:s&&({fromPosition:a,loop:l=l,overwrite:d=d,playbackRate:c=c}=s);const p=e.createBufferSource();p.buffer=r,p.playbackRate.value=c;const u=e.createGain();p.connect(u),u.connect(e.destination);const h=null!=a?a:z(e,o);try{p.start(void 0,h)}catch(e){return}p.loop=l,p.onended=()=>{var e;if(!t[n])return;const{data:i}=t[n];"then"in i||!1!==(null===(e=i.playState)||void 0===e?void 0:e.isPaused)||delete i.playState};const m=o&&!o.isPaused;m&&!d||(o&&m&&(o.sample.onended=null,o.sample.stop()),i.playState={playTime:e.currentTime,sample:p,alreadyPlayedTime:h,isPaused:!1,gainNode:u})},pause:()=>{o&&!o.isPaused&&(o.sample.onended=null,o.sample.stop(),i.playState={...o,alreadyPlayedTime:z(e,o),isPaused:!0})},getStatus:()=>i.playState&&!1===i.playState.isPaused?"playing":"paused",getDuration:()=>r.duration,getVolume:()=>i.playState?i.playState.gainNode.gain.value:1,setVolume:t=>{const n=i.playState;if(n)if("number"==typeof t)n.gainNode.gain.setValueAtTime(Math.max(Math.min(1,t),0),e.currentTime);else{const{type:i,fadeTo:r,fadeTime:o}=t,s=Math.max(Math.min(1,r),0);"linear"===i?n.gainNode.gain.linearRampToValueAtTime(s,e.currentTime+o):n.gainNode.gain.exponentialRampToValueAtTime(s,e.currentTime+o)}}}}}function z(e,t){return t?t.isPaused?t.alreadyPlayedTime:(e.currentTime-t.playTime)*t.sample.playbackRate.value+t.alreadyPlayedTime:0}const X={family:"sans-serif",size:12};function F(e,t,n){const{dimensions:i="game-coords",canvas:r,nativeSpriteMap:o={},windowSize:a,statsBegin:p,statsEnd:u}=t||{},h=r||document.createElement("canvas");r||document.body.appendChild(h);const m=window.PointerEvent?"pointerdown":"touchstart",g=window.PointerEvent?"pointermove":"touchmove",x=window.PointerEvent?"pointerup":"touchend",M=window.PointerEvent?"pointercancel":"touchcancel",z=h.getContext("2d",{alpha:!1}),F=new(window.AudioContext||window.webkitAudioContext);let A=!0,Y=!0,_=0,$=!1,O=0,D=0;const j=()=>{document.hidden&&Y&&(O=_,F.suspend()),document.hidden||Y||($=!0,setTimeout((()=>{F.suspend(),setTimeout((()=>{F.resume()}),75)}),75)),Y=!document.hidden};document.addEventListener("keydown",(e=>{A&&!e.repeat&&w(e)}),!1),document.addEventListener("keyup",(e=>{A&&v(e)}),!1),document.addEventListener("visibilitychange",j,!1),window.addEventListener("resize",q,!1);const H=()=>q({didScroll:!0});let W,N,G,U,B,J;window.addEventListener("scroll",H,!1),document.addEventListener("contextmenu",(e=>{e.preventDefault()}));const V={didResize:!1,scale:1,gameXToPlatformX:e=>e,gameYToPlatformY:e=>e};function q(t){const n=Boolean(t&&"cleanup"in t&&t.cleanup),r=Boolean(t&&"didScroll"in t&&t.didScroll);if(W&&(z.restore(),document.removeEventListener(m,N),document.removeEventListener(g,G),document.removeEventListener(x,U),document.removeEventListener(M,B),n))return;r&&W||(ie.size=I((null==a?void 0:a.width)||window.innerWidth,(null==a?void 0:a.height)||window.innerHeight,i,e.props.size));const o=window.devicePixelRatio||1;h.width=ie.size.deviceWidth*o,h.height=ie.size.deviceHeight*o,h.style.width=`${ie.size.deviceWidth}px`,h.style.height=`${ie.size.deviceHeight}px`;const s=e.props.defaultFont||X,l=e.props.backgroundColor||"white",d=function(e,{width:t,height:n,widthMargin:i,heightMargin:r,deviceWidth:o,deviceHeight:s},a,l,d,c){e.save();const p=o*a,u=s*a,h=t+2*i,m=n+2*r;e.translate(p/2,u/2);const g=p/h;e.scale(g,g);const f=C(e);return{scale:o/h,render:{newFrame:()=>{e.clearRect(-h/2,-m/2,h,m),e.fillStyle=c,e.fillRect(-h/2,-m/2,h,m)},startRenderSprite:t=>{e.save();const n=t.opacity*f.globalAlphaStack[0];k(e,t,n),f.globalAlphaStack.unshift(n)},endRenderSprite:()=>{e.restore(),f.globalAlphaStack.shift()},renderTexture:t=>{e.save();const n=t.props.opacity*f.globalAlphaStack[0];k(e,t.props,n),function(e,t,n,i){switch(e.type){case"text":const r={...i,...e.props.font};return t.text(r,e.props.text,e.props.color,e.props.gradient,e.props.strokeColor,e.props.strokeThickness),0;case"circle":return t.circle(e.props.radius,e.props.color,e.props.gradient),0;case"rectangle":return t.rectangle(e.props.width,e.props.height,e.props.color,e.props.gradient),0;case"line":return t.line(e.props.path,e.props.thickness,e.props.color,e.props.fillColor,e.props.gradient,e.props.fillGradient,e.props.lineCap),0;case"image":return t.image(E(n,e.props.fileName),e.props.width,e.props.height),0;case"spriteSheet":t.spriteSheet(E(n,e.props.fileName),e.props.columns,e.props.rows,e.props.index,e.props.width,e.props.height)}}(t,f,l,d),e.restore()}}}}(z,ie.size,o,Q,s,l);J=d.scale,ne.newFrame=d.render.newFrame,ne.startRenderSprite=d.render.startRenderSprite,ne.endRenderSprite=d.render.endRenderSprite,ne.renderTexture=d.render.renderTexture,V.gameXToPlatformX=(({canvasOffsetLeft:e,widthMargin:t,scale:n,width:i})=>r=>e+n*(r+i/2+t))({canvasOffsetLeft:h.offsetLeft,width:ie.size.width,widthMargin:ie.size.widthMargin,scale:J}),V.gameYToPlatformY=(({canvasOffsetTop:e,heightMargin:t,scale:n,height:i})=>r=>e-n*(r-i/2-t))({canvasOffsetTop:h.offsetTop,height:ie.size.height,heightMargin:ie.size.heightMargin,scale:J}),V.didResize=!0,V.scale=J;const c=(({canvasOffsetLeft:e,scrollX:t,widthMargin:n,scale:i,width:r})=>o=>(o.clientX-e+t)/i-n-r/2)({canvasOffsetLeft:h.offsetLeft,scrollX:window.scrollX,width:ie.size.width,widthMargin:ie.size.widthMargin,scale:J}),p=(({canvasOffsetTop:e,scrollY:t,heightMargin:n,scale:i,height:r})=>o=>-(o.clientY-e+t)/i+n+r/2)({canvasOffsetTop:h.offsetTop,scrollY:window.scrollY,height:ie.size.height,heightMargin:ie.size.heightMargin,scale:J}),u=(e,t)=>e>ie.size.width/2+ie.size.widthMargin||e<-ie.size.width/2-ie.size.widthMargin||t>ie.size.height/2+ie.size.heightMargin||t<-ie.size.height/2-ie.size.heightMargin;N=e=>{if("changedTouches"in e){A=!1;for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=c({clientX:n.screenX}),r=p({clientY:n.screenY});u(i,r)||(A=!0,y(i,r,n.identifier))}return}const t=c(e),n=p(e);u(t,n)?A=!1:(A=!0,y(t,n,e.pointerId))},G=e=>{if("changedTouches"in e){for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=c({clientX:n.screenX}),r=p({clientY:n.screenY});u(i,r)||S(i,r)}return}const t=c(e),n=p(e);u(t,n)||S(t,n)},U=e=>{if("changedTouches"in e){for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=c({clientX:n.screenX}),r=p({clientY:n.screenY});u(i,r)?P(n.identifier):b(i,r,n.identifier)}return}const t=c(e),n=p(e);u(t,n)?P(e.pointerId):b(t,n,e.pointerId)},B=e=>{if("changedTouches"in e)for(let t=0;t<e.changedTouches.length;t++)P(e.changedTouches[t].identifier);else P(e.pointerId)},document.addEventListener(m,N,!1),document.addEventListener(g,G,!1),document.addEventListener(x,U,!1),document.addEventListener(M,B,!1),W=ie.size}const K={},Q={},Z=(e,t)=>()=>{throw Error(`Failed to load ${e} file "${t}"`)},ee=(null==n?void 0:n.fileFetch)||fetch,te={audioElements:K,imageElements:Q,loadAudioFile:e=>async function(e,t){const n=await t,i=await n.arrayBuffer();return await new Promise(((t,n)=>{e.decodeAudioData(i,t,n)}))}(F,ee(e)).then((e=>({buffer:e,volume:1}))).catch(Z("audio",e)),loadImageFile:e=>new Promise(((t,n)=>{const i=new Image;i.addEventListener("load",(()=>{t(i)})),i.addEventListener("error",n),i.src=e})).catch(Z("image",e)),cleanupAudioFile:e=>{const{data:t}=K[e];!("then"in t)&&t.playState&&(t.playState.sample.onended=null,t.playState.sample.disconnect(),t.playState.sample.buffer=null)},cleanupImageFile:()=>null},ne={newFrame:()=>null,startRenderSprite:()=>null,endRenderSprite:()=>null,renderTexture:()=>null},ie=function(e,t,n,i){return{isTouchScreen:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)||window.matchMedia("(touch-enabled),(-webkit-touch-enabled),(-moz-touch-enabled),(-o-touch-enabled),(-ms-touch-enabled)").matches,log:console.log,random:Math.random,timer:L(),audio:R(e,n.audioElements),assetUtils:n,network:{get:(e,t)=>{fetch(e).then((e=>e.json())).then(t)},post:(e,t,n)=>{fetch(e,{method:"POST",body:JSON.stringify(t)}).then((e=>e.json())).then(n)},put:(e,t,n)=>{fetch(e,{method:"PUT",body:JSON.stringify(t)}).then((e=>e.json())).then(n)},delete:(e,t)=>{fetch(e,{method:"DELETE"}).then((e=>e.json())).then(t)}},storage:{getItem:async e=>localStorage.getItem(e),setItem:async(e,t)=>{null!==t?localStorage.setItem(e,t):localStorage.removeItem(e)}},alert:{ok:(e,t)=>{alert(e),null==t||t()},okCancel:(e,t)=>{t(confirm(e))}},clipboard:{copy:(e,t)=>{navigator.clipboard?navigator.clipboard.writeText(e).then((()=>{t()})).catch((e=>{t(e)})):t(new Error(window.isSecureContext?"Couldn't access clipboard":"Clipboard only available on HTTPS or localhost"))}},size:t,now:()=>new Date,...i}}(F,I((null==a?void 0:a.width)||window.innerWidth,(null==a?void 0:a.height)||window.innerHeight,i,e.props.size),te,(null==n?void 0:n.device)||{}),re={mutDevice:ie,getInputs:f,render:ne};let oe=!1;const se=()=>{document.removeEventListener("keydown",se,!1),document.removeEventListener(m,se,!1),"suspended"===F.state&&F.resume(),F.onstatechange=()=>{"suspended"!==F.state||document.hidden||F.resume()}};return document.addEventListener("keydown",se,!1),document.addEventListener(m,se,!1),function t(){const n=(null==a?void 0:a.width)||window.innerWidth,i=(null==a?void 0:a.height)||window.innerHeight;if(!n||!i)return void setTimeout(t,50);q();const{runNextFrame:r}=function(e,t,n,i){const r=({x:e,y:t})=>({x:e,y:t}),{mutDevice:o,getInputs:a}=e,p=d(n,o,(()=>a(r)),0,n.props.id,[]),u=n.props.size,h=c(o.size,u);let m=0,g=0;e.render.newFrame(),s(p,n.props,o,a,r,!0,h,0,n.props.id,t,e.render,[]);const f={newFrame:()=>null,startRenderSprite:()=>null,endRenderSprite:()=>null,renderTexture:()=>null};return{runNextFrame(i,d){const h=i-m;m=i,g+=h;let w=Math.floor(g/l);for(;w>0;){g-=l,w--;const i=g/l,h=c(o.size,u),m=0===w?e.render:f;m.newFrame(),s(p,n.props,o,a,r,!1,h,i,n.props.id,t,m,[]),d()}}}}(re,{nativeSpriteMap:o,nativeSpriteUtils:V},e);let h=null;!function e(){null==u||u(),window.requestAnimationFrame((function(t){oe||(null==p||p(),null===h&&(h=t-1/60),Y?($&&($=!1,D+=t-O),_=t,r(t-h-D,T),e()):e())}))}()}(),{cleanup:function(){h.width=h.width,r||document.body.removeChild(h),oe=!0,document.removeEventListener("keydown",w,!1),document.removeEventListener("keyup",v,!1),document.removeEventListener("visibilitychange",j,!1),window.removeEventListener("resize",q,!1),window.removeEventListener("scroll",H,!1),q({cleanup:!0})},audioElements:K,imageElements:Q,audioContext:F}}function A({id:e,message:t="",message2:n="",message3:i="",message4:r="",message5:o=""}){return new Promise((s=>{new Promise((t=>{let n=window.__replayGlobalCallbacks__;n||(n={},window.__replayGlobalCallbacks__=n),n[e]=e=>{t(e)}})).then((t=>{window.__replayGlobalCallbacks__[e]=void 0,s(t)})),window.Android.bridge(e,t,n,i,r,o)}))}function Y(e){return new Promise((function(t,n){const i=new XMLHttpRequest;i.onload=function(){t(new Response(i.response,{status:i.status}))},i.onerror=function(){n(new TypeError(`Failed to load file: ${e.toString()}`))},i.open("GET",e),i.responseType="arraybuffer",i.send(null)}))}function _(){F(game.Game(game.gameProps),game.options,{fileFetch:Y,device:{storage:{getItem:async e=>{const t=await A({id:`__internalReplayStorageGetItem-${e}`,message:e});if("error"in t)throw Error(t.error);return t.value},setItem:async(e,t)=>{if(null===t){const t=await A({id:`__internalReplayStorageRemoveItem-${e}`,message:e});if("string"==typeof t)throw Error(t);return}const n=await A({id:`__internalReplayStorageSetItem-${e}`,message:e,message2:t});if("string"==typeof n)throw Error(n)}},clipboard:{copy(e,t){A({id:"__internalReplayClipboardCopy",message:e}).then((()=>{t()}))}},alert:{ok:(e,t)=>{A({id:"__internalReplayAlertOk",message:e}).then((()=>{null==t||t()}))},okCancel:(e,t)=>{A({id:"__internalReplayAlertOkCancel",message:e}).then((e=>{t(e)}))}}}})}})(),renderCanvas=t})();