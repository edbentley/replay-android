var renderCanvas;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{function n(e,t,n,i){return t.map((t=>{if(n[t]){n[t].globalSpriteIds.add(e);const{data:i}=n[t];return"then"in i?i:Promise.resolve()}const r=i(t).then((e=>{n[t].data=e}));return n[t]={globalSpriteIds:new Set([e]),data:r},r}))}function i(e,t,n){for(const i in t){const{globalSpriteIds:r}=t[i];r.has(e)&&(1===r.size?(n(i),delete t[i]):t[i].globalSpriteIds.delete(e))}}function r(e){var t,n,i;return{x:e.x||0,y:e.y||0,rotation:e.rotation||0,opacity:Math.min(1,Math.max(0,null!==(t=e.opacity)&&void 0!==t?t:1)),scaleX:null!==(n=e.scaleX)&&void 0!==n?n:1,scaleY:null!==(i=e.scaleY)&&void 0!==i?i:1,anchorX:e.anchorX||0,anchorY:e.anchorY||0,mask:e.mask||null}}function o(e,t){var n,i,r;e.x=t.x||0,e.y=t.y||0,e.rotation=t.rotation||0,e.opacity=Math.min(1,Math.max(0,null!==(n=t.opacity)&&void 0!==n?n:1)),e.scaleX=null!==(i=t.scaleX)&&void 0!==i?i:1,e.scaleY=null!==(r=t.scaleY)&&void 0!==r?r:1,e.anchorX=t.anchorX||0,e.anchorY=t.anchorY||0,e.mask=t.mask||null}function s(e,t,n,r,a,d,u,h,m,g,f){const{baseProps:w}=e;o(w,t);const{nativeSpriteMap:v,nativeSpriteUtils:y}=g,S=e=>{const t=a(e);return function(e){const t=Math.PI/180,n=-(e.rotation||0)*t;return({x:t,y:i})=>{const r=t-e.x,o=i-e.y,s=r*Math.cos(n)+o*Math.sin(n),a=-r*Math.sin(n)+o*Math.cos(n),l=s/e.scaleX,d=a/e.scaleY;return{x:l+e.anchorX,y:d+e.anchorY}}}(w)(t)};let P=null;const b=()=>(P||(P=r(S)),P),T=e.getSprites(t,b,d,u,h),E=new Set(e.prevChildIds);if(E.size<e.prevChildIds.length){const t=e.prevChildIds.find(((t,n)=>e.prevChildIds.indexOf(t)!==n));throw Error(`Duplicate Sprite id ${t}`)}const M=e.prevChildIds;let I=0;f.startRenderSprite(w);for(let t=0;t<T.length;t++){const i=T[t];if(i)if("native"===i.type){M[I]=i.props.id,I++,E.delete(i.props.id);const t=v[i.name];if(!t)throw Error(`Cannot find Native Sprite "${i.name}"`);let n=e.childContainers[i.props.id];if(!n||"native"!==n.type){const r={type:"native",state:t.create({props:i.props,parentGlobalId:m,getState:()=>r.state,updateState:e=>{r.state={...r.state,...e}},utils:y}),cleanup:t.cleanup};e.childContainers[i.props.id]=r,n=r}n.state=t.loop({props:i.props,state:n.state,parentGlobalId:m,utils:y})}else if("pure"===i.type){M[I]=i.props.id,I++,E.delete(i.props.id);let t=e.childContainers[i.props.id];t&&"pure"===t.type||(t=c(i),e.childContainers[i.props.id]=t),p(t,i.props,n.size,y.didResize,u,f)}else if("custom"===i.type){M[I]=i.props.id,I++,E.delete(i.props.id);let t=!1,o=e.childContainers[i.props.id];const a=`${m}--${i.props.id}`;o&&"custom"===o.type||(t=!0,o=l(i,n,b,e.prevTime,a),e.childContainers[i.props.id]=o),s(o,i.props,n,r,S,t,u,h,a,g,f)}else f.renderTexture(i)}f.endRenderSprite(),y.didResize=!1,I<M.length&&(M.length=I),E.forEach((t=>{const r=(e,t)=>{Object.entries(e).forEach((([e,o])=>{if("custom"===o.type){const s=`${t}--${e}`;r(o.childContainers,s),o.loadFilesPromise&&o.loadFilesPromise.then((()=>{var e,t;i(e=s,(t=n.assetUtils).audioElements,t.cleanupAudioFile),i(e,t.imageElements,t.cleanupImageFile)}))}else"native"===o.type&&o.cleanup({state:o.state,parentGlobalId:m})}))},o=e.childContainers[t];r({[t]:o},m),delete e.childContainers[t]}))}e.r(t),e.d(t,{run:()=>A});const a=1/60*1e3;function l(e,t,i,o,s){const{spriteObj:a,props:l}=e,d=[],c=e=>{d.push(e)};let p,u=null,h=null;a.init&&(p=a.init({props:l,getState:()=>{if(!u)throw Error("Cannot call getState synchronously in init");return u.state},device:t,getInputs:i,updateState:c,preloadFiles:async e=>{const i=async function(e,t,i){await Promise.all([...n(e,t.audioFileNames||[],i.audioElements,i.loadAudioFile),...n(e,t.imageFileNames||[],i.imageElements,i.loadImageFile)])}(s,e,t.assetUtils);u?u.loadFilesPromise=i:h=i,await i}}));const m=()=>{let e=0;for(;e<d.length;){const t=d[e];u.state=t(u.state),e++}d.length=0},g=()=>u.state;return u={type:"custom",state:p,baseProps:r(l),childContainers:{},prevChildIds:[],prevTime:o,currentLag:0,loadFilesPromise:h,getSprites(e,n,i,r,o){m(),!i&&a.loop&&(this.state=a.loop({props:e,state:this.state,device:t,getInputs:n,updateState:c,getState:g})),m();let s=a[r];s||(s="renderPXL"===r&&a.renderXL?a.renderXL:a.render);const l=s({props:e,state:this.state,device:t,getInputs:n,updateState:c,getState:g,extrapolateFactor:o});return m(),l}},u}function d(e,t){const n=e.deviceHeight>e.deviceWidth;let i,r=!1;return"portrait"in t?(i=n?t.portrait:t.landscape,r=!0):i=t,i.minHeightXL&&e.deviceHeight>=i.minHeightXL||i.minWidthXL&&e.deviceWidth>=i.minWidthXL?r&&n?"renderPXL":"renderXL":r&&n?"renderP":"render"}function c(e){const{spriteObj:t}=e;return{type:"pure",childContainers:{},prevChildIds:[],baseProps:r(e.props),getSprites(e,n,i,r){if(this.prevProps&&this.cache&&!t.shouldRerender(this.prevProps,e)&&!i)return this.prevProps=e,this.cache;let o=t[r];return o||(o="renderPXL"===r&&t.renderXL?t.renderXL:t.render),this.prevProps=e,{type:"pureSprites",sprites:o({props:e,size:n})}}}}function p(e,t,n,i,r,s){const{baseProps:a}=e;o(a,t);const l=e.getSprites(t,n,i,r);return"cache"===l.type?(u(l,s),l):function(e,t,n,i,r,o){const{baseProps:s}=e,a=new Set(e.prevChildIds),l=e.prevChildIds;let d=0;o.startRenderSprite(s);const u=new Array(t.length);let h=0;for(let s=0;s<t.length;s++){const m=t[s];if(m)if("pure"===m.type){l[d]=m.props.id,d++,a.delete(m.props.id);let t=e.childContainers[m.props.id];t&&"pure"===t.type||(t=c(m),e.childContainers[m.props.id]=t),u[h]=p(t,m.props,n,i,r,o),h++}else o.renderTexture(m),u[h]=m,h++}h<u.length&&(u.length=h),o.endRenderSprite(),a.forEach((t=>{delete e.childContainers[t]}));const m={type:"cache",baseProps:s,items:u};return e.cache=m,d<l.length&&(l.length=d),m}(e,l.sprites,n,i,r,s)}function u(e,t){t.startRenderSprite(e.baseProps);for(let n=0;n<e.items.length;n++){const i=e.items[n];"cache"===i.type?u(i,t):t.renderTexture(i)}t.endRenderSprite()}let h={keysDown:{},keysJustPressed:{},pointer:{pressed:!1,numberPressed:0,justPressed:!1,justReleased:!1,x:0,y:0}},m=[];function g(e){return function(e,t){const n=e(t.pointer);return{...t,pointer:{...t.pointer,x:n.x,y:n.y}}}(e,h)}function f(e){["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)&&!(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement)&&e.preventDefault(),h.keysDown[e.key]=!0,h.keysJustPressed[e.key]=!0}function w(e){delete h.keysDown[e.key]}function v(e,t,n){m.includes(n)||(m=[...m,n]),h.pointer.pressed=!0,h.pointer.numberPressed=m.length,h.pointer.justPressed=!0,h.pointer.x=e,h.pointer.y=t}function y(e,t){h.pointer.x=e,h.pointer.y=t}function S(e,t,n){m=m.filter((e=>e!==n)),0===m.length&&(h.pointer.justPressed=!1,h.pointer.pressed=!1),h.pointer.numberPressed=m.length,h.pointer.justReleased=!0,h.pointer.x=e,h.pointer.y=t}function P(e){m=m.filter((t=>t!==e)),h.pointer.numberPressed=m.length,0===m.length&&(h.pointer.justPressed=!1,h.pointer.pressed=!1)}function b(){h={keysDown:h.keysDown,keysJustPressed:{},pointer:{...h.pointer,justPressed:!1,justReleased:!1}}}const T=(e,t)=>{const n=e[t];if(!n)throw Error(`Image file "${t}" was not preloaded`);if("then"in n.data)throw Error(`Image file "${t}" did not finish loading before it was used`);return n.data},E=Math.PI/180,M=(e,t,n)=>{const{x:i,y:r,rotation:o,scaleX:s,scaleY:a,anchorX:l,anchorY:d,opacity:c}=t;0===i&&0===r||e.translate(i,-r),0!==o&&e.rotate(o*E),1===s&&1===a||e.scale(s,a),0===l&&0===d||e.translate(-l,d),1!==c&&(e.globalAlpha=n),function(e,t){if(!t)return 0;switch(t.type){case"lineMask":{const[[n,i],...r]=t.path;return e.beginPath(),e.moveTo(n,-i),r.forEach((([t,n])=>{e.lineTo(t,-n)})),e.clip(),0}case"circleMask":return e.beginPath(),e.arc(t.x,-t.y,Math.round(t.radius),0,2*Math.PI),e.clip(),0;case"rectangleMask":e.beginPath(),e.rect(t.x-t.width/2,-t.y-t.height/2,t.width,t.height),e.clip()}}(e,t.mask)},I=e=>({globalAlphaStack:[1],circle(t,n){e.beginPath(),e.arc(0,0,Math.round(t),0,2*Math.PI),e.fillStyle=n,e.fill(),e.closePath()},rectangle(t,n,i){e.fillStyle=i,e.fillRect(-t/2,-n/2,t,n),e.closePath()},line(t,n,i,r,o){if(t.length<2)return;const[[s,a],...l]=t;e.beginPath(),e.moveTo(s,-a),l.forEach((([t,n])=>{e.lineTo(t,-n)})),r&&(e.fillStyle=r,e.fill()),i&&(e.strokeStyle=i,e.lineWidth=n,e.lineCap=o,e.stroke())},text(t,n,i){const{size:r,weight:o="normal",style:s="normal",family:a}=t,l=`${s} ${o} ${r?`${r}px`:""} ${a?`${a}`:""}`;e.font=l,e.textBaseline=t.baseline||"middle",e.textAlign=t.align||"center",e.fillStyle=i,e.fillText(n,0,0)},image(t,n,i){e.drawImage(t,-n/2,-i/2,n,i)},spriteSheet(t,n,i,r,o,s){const a=t.width/n,l=t.height/i,d=r%n,c=Math.floor(r/n)%i;e.drawImage(t,d*a,c*l,a,l,-o/2,-s/2,o,s)}});function k(e,t,n,i){let r;r="portrait"in i?t>e?i.portrait:i.landscape:i;const{width:o,height:s,maxWidthMargin:a=0,maxHeightMargin:l=0}=r;if("game-coords"===n)return{width:o,height:s,widthMargin:0,heightMargin:0,deviceWidth:o,deviceHeight:s};const d=o/s;if(d>e/t){const n=e,i=n/d,r=i/s*l,a=Math.min(t,i+2*r);return{width:o,height:s,widthMargin:0,heightMargin:(a-i)/2*(s/i),deviceWidth:n,deviceHeight:a}}{const n=t,i=n*d,r=i/o*a,l=Math.min(e,i+2*r);return{width:o,height:s,widthMargin:(l-i)/2*(o/i),heightMargin:0,deviceWidth:l,deviceHeight:n}}}function x(){const e={};return{start:(t,n)=>{const i=window.setTimeout((()=>{delete e[r],t()}),n),r=String(i);return e[r]={timeoutId:i,callback:t,timeStartedMs:Date.now(),timeRemainingMs:n,isPaused:!1},r},pause:t=>{const n=e[t];if(!n||n.isPaused)return;const i=Date.now()-n.timeStartedMs;n.timeRemainingMs-=i,n.isPaused=!0,window.clearTimeout(n.timeoutId)},resume:t=>{const n=e[t];if(!n||!n.isPaused)return;n.timeStartedMs=Date.now(),n.isPaused=!1;const i=window.setTimeout((()=>{delete e[t],n.callback()}),n.timeRemainingMs);n.timeoutId=i},cancel:t=>{const n=e[t];n&&(window.clearTimeout(n.timeoutId),delete e[t])}}}function L(e,t){return n=>{if(!t[n])throw Error(`Audio file "${n}" was not preloaded`);const{data:i}=t[n];if("then"in i)throw Error(`Audio file "${n}" did not finish loading before it was used`);const{buffer:r,playState:o}=i;return{getPosition:()=>C(e,i.playState),play:s=>{let a,l=!1,d=!1,c=1;"number"==typeof s?a=s:s&&({fromPosition:a,loop:l=l,overwrite:d=d,playbackRate:c=c}=s);const p=e.createBufferSource();p.buffer=r,p.playbackRate.value=c;const u=e.createGain();p.connect(u),u.connect(e.destination);const h=null!=a?a:C(e,o);p.start(void 0,h),p.loop=l,p.onended=()=>{var e;if(!t[n])return;const{data:i}=t[n];"then"in i||!1!==(null===(e=i.playState)||void 0===e?void 0:e.isPaused)||delete i.playState};const m=o&&!o.isPaused;m&&!d||(o&&m&&(o.sample.onended=null,o.sample.stop()),i.playState={playTime:e.currentTime,sample:p,alreadyPlayedTime:h,isPaused:!1,gainNode:u})},pause:()=>{o&&!o.isPaused&&(o.sample.stop(),i.playState={...o,alreadyPlayedTime:C(e,o),isPaused:!0})},getStatus:()=>i.playState&&!1===i.playState.isPaused?"playing":"paused",getDuration:()=>r.duration,getVolume:()=>i.playState?i.playState.gainNode.gain.value:1,setVolume:e=>{const t=i.playState;t&&e>=0&&e<=1&&(t.gainNode.gain.value=e)}}}}function C(e,t){return t?t.isPaused?t.alreadyPlayedTime:(e.currentTime-t.playTime)*t.sample.playbackRate.value+t.alreadyPlayedTime:0}const R={family:"sans-serif",size:12};function z(e,t,n){const{dimensions:i="game-coords",canvas:r,nativeSpriteMap:o={},windowSize:c,statsBegin:p,statsEnd:u}=t||{},h=r||document.createElement("canvas");r||document.body.appendChild(h);const m=window.PointerEvent?"pointerdown":"touchstart",E=window.PointerEvent?"pointermove":"touchmove",C=window.PointerEvent?"pointerup":"touchend",z=window.PointerEvent?"pointercancel":"touchcancel",X=h.getContext("2d",{alpha:!1}),F=new(window.AudioContext||window.webkitAudioContext);let A=!0,Y=!0,_=0,O=!1,$=0,D=0;const j=()=>{document.hidden&&Y&&($=_,F.suspend()),document.hidden||Y||(O=!0,setTimeout((()=>{F.suspend(),setTimeout((()=>{F.resume()}),75)}),75)),Y=!document.hidden};document.addEventListener("keydown",(e=>{A&&!e.repeat&&f(e)}),!1),document.addEventListener("keyup",(e=>{A&&w(e)}),!1),document.addEventListener("visibilitychange",j,!1),window.addEventListener("resize",V,!1);const H=()=>V({didScroll:!0});let W,N,G,U,B,J;window.addEventListener("scroll",H,!1),document.addEventListener("contextmenu",(e=>{e.preventDefault()}));const q={didResize:!1,scale:1,gameXToPlatformX:e=>e,gameYToPlatformY:e=>e};function V(t){const n=Boolean(t&&"cleanup"in t&&t.cleanup),r=Boolean(t&&"didScroll"in t&&t.didScroll);if(W&&(X.restore(),document.removeEventListener(m,N),document.removeEventListener(E,G),document.removeEventListener(C,U),document.removeEventListener(z,B),n))return;r&&W||(ie.size=k((null==c?void 0:c.width)||window.innerWidth,(null==c?void 0:c.height)||window.innerHeight,i,e.props.size)),h.width=ie.size.deviceWidth,h.height=ie.size.deviceHeight;const o=e.props.defaultFont||R,s=function(e,{width:t,height:n,widthMargin:i,heightMargin:r,deviceWidth:o,deviceHeight:s},a,l){e.save();const d=Math.min(o/t,s/n),c=t+2*i,p=n+2*r;e.translate(o/2,s/2),e.scale(d,d);const u=I(e);return{scale:d,render:{newFrame:()=>{e.clearRect(-o/2/d,-s/2/d,o/d,s/d),e.fillStyle="white",e.fillRect(-c/2,-p/2,c,p)},startRenderSprite:t=>{e.save();const n=t.opacity*u.globalAlphaStack[0];M(e,t,n),u.globalAlphaStack.unshift(n)},endRenderSprite:()=>{e.restore(),u.globalAlphaStack.shift()},renderTexture:t=>{e.save();const n=t.props.opacity*u.globalAlphaStack[0];M(e,t.props,n),function(e,t,n,i){switch(e.type){case"text":const r={...i,...e.props.font};return t.text(r,e.props.text,e.props.color),0;case"circle":return t.circle(e.props.radius,e.props.color),0;case"rectangle":return t.rectangle(e.props.width,e.props.height,e.props.color),0;case"line":return t.line(e.props.path,e.props.thickness,e.props.color,e.props.fillColor,e.props.lineCap),0;case"image":return t.image(T(n,e.props.fileName),e.props.width,e.props.height),0;case"spriteSheet":t.spriteSheet(T(n,e.props.fileName),e.props.columns,e.props.rows,e.props.index,e.props.width,e.props.height)}}(t,u,a,l),e.restore()}}}}(X,ie.size,Q,o);J=s.scale,ne.newFrame=s.render.newFrame,ne.startRenderSprite=s.render.startRenderSprite,ne.endRenderSprite=s.render.endRenderSprite,ne.renderTexture=s.render.renderTexture,q.gameXToPlatformX=(({canvasOffsetLeft:e,widthMargin:t,scale:n,width:i})=>r=>e+n*(r+i/2+t))({canvasOffsetLeft:h.offsetLeft,width:ie.size.width,widthMargin:ie.size.widthMargin,scale:J}),q.gameYToPlatformY=(({canvasOffsetTop:e,heightMargin:t,scale:n,height:i})=>r=>e-n*(r-i/2-t))({canvasOffsetTop:h.offsetTop,height:ie.size.height,heightMargin:ie.size.heightMargin,scale:J}),q.didResize=!0,q.scale=J;const a=(({canvasOffsetLeft:e,scrollX:t,widthMargin:n,scale:i,width:r})=>o=>(o.clientX-e+t)/i-n-r/2)({canvasOffsetLeft:h.offsetLeft,scrollX:window.scrollX,width:ie.size.width,widthMargin:ie.size.widthMargin,scale:J}),l=(({canvasOffsetTop:e,scrollY:t,heightMargin:n,scale:i,height:r})=>o=>-(o.clientY-e+t)/i+n+r/2)({canvasOffsetTop:h.offsetTop,scrollY:window.scrollY,height:ie.size.height,heightMargin:ie.size.heightMargin,scale:J}),d=(e,t)=>e>ie.size.width/2+ie.size.widthMargin||e<-ie.size.width/2-ie.size.widthMargin||t>ie.size.height/2+ie.size.heightMargin||t<-ie.size.height/2-ie.size.heightMargin;N=e=>{if("changedTouches"in e){A=!1;for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=a({clientX:n.screenX}),r=l({clientY:n.screenY});d(i,r)||(A=!0,v(i,r,n.identifier))}return}const t=a(e),n=l(e);d(t,n)?A=!1:(A=!0,v(t,n,e.pointerId))},G=e=>{if("changedTouches"in e){for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=a({clientX:n.screenX}),r=l({clientY:n.screenY});d(i,r)||y(i,r)}return}const t=a(e),n=l(e);d(t,n)||y(t,n)},U=e=>{if("changedTouches"in e){for(let t=0;t<e.changedTouches.length;t++){const n=e.changedTouches[t],i=a({clientX:n.screenX}),r=l({clientY:n.screenY});d(i,r)?P(n.identifier):S(i,r,n.identifier)}return}const t=a(e),n=l(e);d(t,n)?P(e.pointerId):S(t,n,e.pointerId)},B=e=>{if("changedTouches"in e)for(let t=0;t<e.changedTouches.length;t++)P(e.changedTouches[t].identifier);else P(e.pointerId)},document.addEventListener(m,N,!1),document.addEventListener(E,G,!1),document.addEventListener(C,U,!1),document.addEventListener(z,B,!1),W=ie.size}const K={},Q={},Z=(e,t)=>()=>{throw Error(`Failed to load ${e} file "${t}"`)},ee=(null==n?void 0:n.fileFetch)||fetch,te={audioElements:K,imageElements:Q,loadAudioFile:e=>async function(e,t){const n=await t,i=await n.arrayBuffer();return await new Promise(((t,n)=>{e.decodeAudioData(i,t,n)}))}(F,ee(e)).then((e=>({buffer:e,volume:1}))).catch(Z("audio",e)),loadImageFile:e=>new Promise(((t,n)=>{const i=new Image;i.addEventListener("load",(()=>{t(i)})),i.addEventListener("error",n),i.src=e})).catch(Z("image",e)),cleanupAudioFile:e=>{const{data:t}=K[e];!("then"in t)&&t.playState&&(t.playState.sample.onended=null,t.playState.sample.disconnect(),t.playState.sample.buffer=null)},cleanupImageFile:()=>null},ne={newFrame:()=>null,startRenderSprite:()=>null,endRenderSprite:()=>null,renderTexture:()=>null},ie=function(e,t,n,i){return{isTouchScreen:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)||window.matchMedia("(touch-enabled),(-webkit-touch-enabled),(-moz-touch-enabled),(-o-touch-enabled),(-ms-touch-enabled)").matches,log:console.log,random:Math.random,timer:x(),audio:L(e,n.audioElements),assetUtils:n,network:{get:(e,t)=>{fetch(e).then((e=>e.json())).then(t)},post:(e,t,n)=>{fetch(e,{method:"POST",body:JSON.stringify(t)}).then((e=>e.json())).then(n)},put:(e,t,n)=>{fetch(e,{method:"PUT",body:JSON.stringify(t)}).then((e=>e.json())).then(n)},delete:(e,t)=>{fetch(e,{method:"DELETE"}).then((e=>e.json())).then(t)}},storage:{getItem:async e=>localStorage.getItem(e),setItem:async(e,t)=>{null!==t?localStorage.setItem(e,t):localStorage.removeItem(e)}},alert:{ok:(e,t)=>{alert(e),null==t||t()},okCancel:(e,t)=>{t(confirm(e))}},clipboard:{copy:(e,t)=>{navigator.clipboard?navigator.clipboard.writeText(e).then((()=>{t()})).catch((e=>{t(e)})):t(new Error(window.isSecureContext?"Couldn't access clipboard":"Clipboard only available on HTTPS or localhost"))}},size:t,now:()=>new Date,...i}}(F,k((null==c?void 0:c.width)||window.innerWidth,(null==c?void 0:c.height)||window.innerHeight,i,e.props.size),te,(null==n?void 0:n.device)||{}),re={mutDevice:ie,getInputs:g,render:ne};V();let oe=!1;const se=()=>{document.removeEventListener("keydown",se,!1),document.removeEventListener(m,se,!1),"suspended"===F.state&&F.resume(),F.onstatechange=()=>{"suspended"!==F.state||document.hidden||F.resume()}};document.addEventListener("keydown",se,!1),document.addEventListener(m,se,!1);const{runNextFrame:ae}=function(e,t,n,i){const r=({x:e,y:t})=>({x:e,y:t}),{mutDevice:o,getInputs:c}=e,p=l(n,o,(()=>c(r)),0,n.props.id),u=n.props.size,h=d(o.size,u);let m=0,g=0;s(p,n.props,o,c,r,!0,h,0,n.props.id,t,e.render);const f={newFrame:()=>null,startRenderSprite:()=>null,endRenderSprite:()=>null,renderTexture:()=>null};return{runNextFrame(i,l){const h=i-m;m=i,g+=h;let w=Math.floor(g/a);for(;w>0;){g-=a,w--;const i=g/a,h=d(o.size,u),m=0===w?e.render:f;m.newFrame(),s(p,n.props,o,c,r,!1,h,i,n.props.id,t,m),l()}}}}(re,{nativeSpriteMap:o,nativeSpriteUtils:q},e);let le=null;return function e(){null==u||u(),window.requestAnimationFrame((function(t){oe||(null==p||p(),null===le&&(le=t-1/60),O&&(O=!1,D+=t-$),_=t,ae(t-le-D,b),e())}))}(),{cleanup:function(){h.width=h.width,r||document.body.removeChild(h),oe=!0,document.removeEventListener("keydown",f,!1),document.removeEventListener("keyup",w,!1),document.removeEventListener("visibilitychange",j,!1),window.removeEventListener("resize",V,!1),window.removeEventListener("scroll",H,!1),V({cleanup:!0})},audioElements:K,imageElements:Q,audioContext:F}}function X({id:e,message:t="",message2:n="",message3:i="",message4:r="",message5:o=""}){return new Promise((s=>{new Promise((t=>{let n=window.__replayGlobalCallbacks__;n||(n={},window.__replayGlobalCallbacks__=n),n[e]=e=>{t(e)}})).then((t=>{window.__replayGlobalCallbacks__[e]=void 0,s(t)})),window.Android.bridge(e,t,n,i,r,o)}))}function F(e){return new Promise((function(t,n){const i=new XMLHttpRequest;i.onload=function(){t(new Response(i.response,{status:i.status}))},i.onerror=function(){n(new TypeError(`Failed to load file: ${e.toString()}`))},i.open("GET",e),i.responseType="arraybuffer",i.send(null)}))}function A(){z(game.Game(game.gameProps),game.options,{fileFetch:F,device:{storage:{getItem:async e=>{const t=await X({id:`__internalReplayStorageGetItem-${e}`,message:e});if("error"in t)throw Error(t.error);return t.value},setItem:async(e,t)=>{if(null===t){const t=await X({id:`__internalReplayStorageRemoveItem-${e}`,message:e});if("string"==typeof t)throw Error(t);return}const n=await X({id:`__internalReplayStorageSetItem-${e}`,message:e,message2:t});if("string"==typeof n)throw Error(n)}},clipboard:{copy(e,t){X({id:"__internalReplayClipboardCopy",message:e}).then((()=>{t()}))}},alert:{ok:(e,t)=>{X({id:"__internalReplayAlertOk",message:e}).then((()=>{null==t||t()}))},okCancel:(e,t)=>{X({id:"__internalReplayAlertOkCancel",message:e}).then((e=>{t(e)}))}}}})}})(),renderCanvas=t})();